'use client'; import { useParams, useRouter } from 'next/navigation'; import { useEffect, useMemo, useState } from 'react'; import UploadStep from '@/components/UploadStep'; import { useCart } from '@/lib/cart'; function cents(n:number){return(n/100).toFixed(2).replace('.',',')} type Product={slug:string;name:string;description:string;sizeMM:number;basePriceCents:number;colors:string[];epoxyEnabled:boolean}; export default function ProductPage(){ const { slug } = useParams(); const [p,setP]=useState<Product|null>(null); const [color,setColor]=useState('white'); const [epoxy,setEpoxy]=useState<'yes'|'no'>('no'); const [qty,setQty]=useState(1); const [step,setStep]=useState<'select'|'upload'>('select'); const router=useRouter(); const { add } = useCart(); useEffect(()=>{ fetch(`/api/products/${slug}`).then(r=>r.json()).then(setP); },[slug]); const unitPrice=useMemo(()=> (p? p.basePriceCents + (epoxy==='yes'?700:0):0), [p,epoxy]); function onUploaded(publicIds:string[]){ if(!p) return; add({ id: Math.random().toString(36).slice(2,9), productSlug:p.slug, color, epoxy, unitPriceCents:unitPrice, qty, imagePublicIds:publicIds }); router.push('/cart'); } if(!p) return <div>Laden…</div>; return (<div className='grid md:grid-cols-2 gap-8'><div className='card'><div className='aspect-square bg-slate-50 rounded grid place-items-center text-slate-400'>Preview {p.sizeMM}×{p.sizeMM}</div></div><div className='space-y-5'><div><h1 className='text-2xl font-semibold'>{p.name}</h1><p className='text-slate-600'>{p.description}</p></div>{step==='select'&&(<div className='space-y-4'><div><div className='text-sm font-medium mb-1'>Farbe</div><div className='grid grid-cols-3 gap-2'>{p.colors.map(c=>(<button key={c} type='button' onClick={()=>setColor(c)} className={`border rounded px-2 py-1 capitalize ${color===c?'ring-2 ring-offset-2':''}`}>{c}</button>))}</div></div>{p.epoxyEnabled&&(<div><div className='text-sm font-medium mb-1'>Epoxidharz</div><div className='flex gap-3'><label className='flex items-center gap-2'><input type='radio' name='epoxy' checked={epoxy==='no'} onChange={()=>setEpoxy('no')} />ohne</label><label className='flex items-center gap-2'><input type='radio' name='epoxy' checked={epoxy==='yes'} onChange={()=>setEpoxy('yes')} />mit</label></div></div>)}<div><div className='text-sm font-medium mb-1'>Menge</div><input type='number' min={1} value={qty} onChange={e=>setQty(Math.max(1, Number(e.target.value)||1))} className='border rounded px-2 py-1 w-28' /></div><div className='flex items-center justify-between'><div className='text-lg font-semibold'>{cents(unitPrice)} € / Stück</div><button className='btn' onClick={()=>setStep('upload')}>Weiter: Bilder hochladen</button></div></div>)}{step==='upload'&&(<div className='space-y-4'><h2 className='text-lg font-semibold'>Uploads für {qty} Stück</h2><UploadStep quantity={qty} onDone={onUploaded} /><button className='text-sm underline' onClick={()=>setStep('select')}>Zurück</button></div>)}</div></div>); }