import { NextRequest, NextResponse } from 'next/server'; import { v2 as cloudinary } from 'cloudinary'; export const runtime='nodejs'; cloudinary.config({ cloud_name: process.env.CLOUDINARY_CLOUD_NAME, api_key: process.env.CLOUDINARY_API_KEY, api_secret: process.env.CLOUDINARY_API_SECRET }); export async function POST(req: NextRequest){ try{ const form=await req.formData(); const file=form.get('file'); if(!file || !(file instanceof File)) return NextResponse.json({error:'No file provided'},{status:400}); const buf=Buffer.from(await file.arrayBuffer()); const result=await new Promise((resolve,reject)=>{ cloudinary.uploader.upload_stream({ folder:'little-voice-studio/uploads' },(err,res)=> err?reject(err):resolve(res)).end(buf); }); return NextResponse.json(result); }catch(e:any){ return NextResponse.json({error:e.message||'Upload failed'},{status:500}); } }