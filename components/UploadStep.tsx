'use client'; import { useState } from 'react'; export default function UploadStep({quantity,onDone}:{quantity:number,onDone:(ids:string[])=>void}){ const [files,setFiles]=useState<File[]>([]); const [uploading,setUploading]=useState(false); const [uploaded,setUploaded]=useState<string[]>([]); function select(fs:FileList|null){const arr=Array.from(fs||[]); setFiles(arr.slice(0,quantity));} async function go(){ if(files.length!==quantity){alert(`Bitte genau ${quantity} Datei(en) auswählen.`);return;} setUploading(true); const ids:string[]=[]; try{ for(const f of files){ const body=new FormData(); body.append('file',f); const res=await fetch('/api/upload',{method:'POST',body}); if(!res.ok) throw new Error('Upload failed'); const data=await res.json(); ids.push(data.public_id); setUploaded([...ids]); } onDone(ids); }catch(e:any){ alert(e.message); } finally{ setUploading(false);} } return (<div className='space-y-3'><p className='text-sm text-slate-600'>Lade {quantity} Bild-Datei(en) hoch (Mehrfachauswahl möglich).</p><input type='file' accept='image/*' multiple onChange={e=>select(e.target.files)} /><div className='text-sm text-slate-600'>Ausgewählt: {files.length}/{quantity}</div><button disabled={uploading} className='btn' onClick={go}>{uploading?'Hochladen…':'Hochladen & in den Warenkorb'}</button>{uploaded.length>0 && <div className='text-xs text-green-700'>Hochgeladen: {uploaded.length}/{quantity}</div>}</div>); }